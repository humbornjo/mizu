version: v2
clean: false

managed:
  enabled: true

  override:
    - file_option: go_package_prefix
      value: mizu.example/protogen

  disable:
    - module: buf.build/googleapis/googleapis
      file_option: go_package_prefix

plugins:
  - remote: buf.build/connectrpc/go:v1.18.1
    out: dist
    opt:
      - paths=source_relative

  - remote: buf.build/protocolbuffers/go:v1.36.6
    out: dist
    opt:
      - paths=source_relative

  # google-gnostic-openapi only compile out the rpc with google
  # api annotations. Not very friendly for Connect RPC, but still
  # kind of make sense because OPENAPI is for HTTP, other RPCs
  # can be detected by GRPC protoreflect. (And there is only one
  # compiled output, save a lot work to build Go CI flow)
  - remote: buf.build/community/google-gnostic-openapi:v0.7.1
    out: dist

  # https://github.com/sudorandom/protoc-gen-connect-openapi
  # This plugin is better for Connect RPC, however what MIZU aim
  # for is integrating OPENAPI into Go ecosystem. Separate
  # compiling outputs make it hard to attach go:embed support.
  #
  # - remote: buf.build/community/sudorandom-connect-openapi:v0.21.3
  #   out: dist
